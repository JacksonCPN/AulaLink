document.addEventListener("DOMContentLoaded", function() {
  // Substitua 'SEU_CLIENT_ID' pelo ID de cliente da sua aplicação do Google Cloud.
  const CLIENT_ID = 'SEU_CLIENT_ID';
  
  // Configure as credenciais da API do Google Meet.
  gapi.load('client:auth2', initClient);

  function initClient() {
    gapi.client.init({
      clientId: CLIENT_ID,
      scope: 'https://www.googleapis.com/auth/calendar.events'
    }).then(function() {
      // Adicione um manipulador de eventos ao botão de iniciar chamada.
      const startMeetingButton = document.getElementById('startMeetingButton');
      startMeetingButton.addEventListener('click', startMeeting);

      // Verifique se o usuário está autenticado.
      if (gapi.auth2.getAuthInstance().isSignedIn.get()) {
        startMeetingButton.disabled = false;
      }
    });
  }

  function startMeeting() {
    gapi.client.calendar.events
      .insert({
        calendarId: 'primary',
        resource: {
          summary: 'Reunião no Google Meet',
          description: 'Uma reunião no Google Meet iniciada a partir de uma aplicação web.',
          start: {
            dateTime: new Date().toISOString(),
          },
          end: {
            dateTime: new Date(new Date().getTime() + 600000).toISOString(),
          },
          conferenceData: {
            createRequest: {
              requestId: 'abcdefg'
            }
          }
        },
      })
      .then(function(response) {
        const meetingURL = response.result.hangoutLink;
        window.open(meetingURL, '_blank');
      })
      .catch(function(error) {
        console.error('Erro ao criar a reunião no Google Meet: ' + error);
      });
  }
});
